name: Build Mac App

on:
   push:
     tags:
       - 'v*'

jobs:
   build:
     runs-on: macos-latest
    
     steps:
     - uses: actions/checkout@v2
    
     - name: Set up Python
       uses: actions/setup-python@v2
       with:
         python-version: '3.9'
    
     - name: Install dependencies
       run: |
         python -m pip install --upgrade pip
         pip install pyinstaller
         pip install -e .
    
     - name: Build Mac App
       run: |
         pyinstaller frame-tool/FrameGifTool.spec
         cd dist
         zip -r FrameGifTool-Mac.zip FrameGifTool.app
    
     - name: Create Release
       id: create_release
       uses: actions/create-release@v1
       env:
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       with:
         tag_name: ${{ github.ref }}
         release_name: Release ${{ github.ref }}
         draft: false
         prerelease: false
    
     - name: Upload Release Asset
       uses: actions/upload-release-asset@v1
       env:
         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       with:
         upload_url: ${{ steps.create_release.outputs.upload_url }}
         asset_path: ./dist/FrameGifTool-Mac.zip
         asset_name: FrameGifTool-Mac.zip
         asset_content_type: application/zip